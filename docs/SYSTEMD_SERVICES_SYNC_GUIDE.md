# Chat Copilot Platform - Systemd Services Synchronization Guide\n\n## üéØ Overview\n\nThis guide covers the systemd services synchronization capabilities for the Chat Copilot platform. The system automatically detects, backs up, and synchronizes platform-related systemd service files between different computers, ensuring consistent service deployment across development, staging, and production environments.\n\n## üîß Systemd Services Detected\n\nThe system automatically detects and manages these platform-related service patterns:\n\n- `*ai-platform*` - AI platform core services\n- `*chat-copilot*` - Chat Copilot specific services\n- `*openwebui*` - OpenWebUI services\n- `*ollama*` - Ollama LLM services\n- `*perplexica*` - Perplexica search services\n- `*searxng*` - SearXNG search engine services\n- `*autogen*` - AutoGen Studio services\n- `*magentic*` - Magentic-One services\n\n## üöÄ Quick Start\n\n### 1. Scan Local Services\n\n```bash\n# Scan for platform-related systemd services\n./scripts/sync/rsync-systemd-services.sh scan\n\n# Show detailed status\n./scripts/sync/rsync-systemd-services.sh status\n```\n\n### 2. Backup Services\n\n```bash\n# Create backup of current services\n./scripts/sync/rsync-systemd-services.sh backup\n\n# Backup to custom location\n./scripts/sync/rsync-systemd-services.sh backup --backup-dir /path/to/backup\n```\n\n### 3. Sync with Remote\n\n```bash\n# Push services to development server\n./scripts/sync/rsync-systemd-services.sh push dev-server\n\n# Pull services from production\n./scripts/sync/rsync-systemd-services.sh pull prod-server --dry-run\n\n# Bidirectional sync\n./scripts/sync/rsync-systemd-services.sh sync staging-server\n```\n\n### 4. Integrated Platform Sync\n\n```bash\n# Include systemd services in platform sync\n./scripts/sync/rsync-platform-enhanced.sh push dev-server --include-systemd\n\n# Full deployment including systemd services\n./scripts/sync/rsync-platform-enhanced.sh full-deploy prod-server\n```\n\n## üìã Available Commands\n\n### Systemd Services Script\n\n```bash\n# Basic operations\n./scripts/sync/rsync-systemd-services.sh scan              # Scan local services\n./scripts/sync/rsync-systemd-services.sh backup            # Backup services\n./scripts/sync/rsync-systemd-services.sh list              # List services\n./scripts/sync/rsync-systemd-services.sh status            # Show service status\n\n# Remote operations\n./scripts/sync/rsync-systemd-services.sh push <target>     # Push to remote\n./scripts/sync/rsync-systemd-services.sh pull <target>     # Pull from remote\n./scripts/sync/rsync-systemd-services.sh sync <target>     # Bidirectional sync\n\n# Service management\n./scripts/sync/rsync-systemd-services.sh install          # Install from backup\n./scripts/sync/rsync-systemd-services.sh enable           # Enable services\n./scripts/sync/rsync-systemd-services.sh disable          # Disable services\n```\n\n### Enhanced Platform Script\n\n```bash\n# Platform sync with systemd\n./scripts/sync/rsync-platform-enhanced.sh push <target> --include-systemd\n./scripts/sync/rsync-platform-enhanced.sh pull <target> --include-systemd\n./scripts/sync/rsync-platform-enhanced.sh sync <target> --include-systemd\n\n# Full deployment\n./scripts/sync/rsync-platform-enhanced.sh full-deploy <target>\n\n# Systemd command delegation\n./scripts/sync/rsync-platform-enhanced.sh systemd scan\n./scripts/sync/rsync-platform-enhanced.sh systemd push dev-server\n```\n\n## üîí Security and Permissions\n\n### Sudo Requirements\n\nSystemd operations require sudo privileges for:\n- Installing service files to `/etc/systemd/system/`\n- Enabling/disabling services\n- Starting/stopping services\n- Reloading systemd daemon\n\n### SSH Sudo Setup\n\nFor remote operations, configure passwordless sudo:\n\n```bash\n# On remote server, edit sudoers\nsudo visudo\n\n# Add line (replace 'username' with actual username):\nusername ALL=(ALL) NOPASSWD: /bin/systemctl, /bin/cp, /bin/mkdir, /bin/chown\n```\n\n### Service File Security\n\n```bash\n# Service files are backed up before any changes\n# Backups include service states (active/inactive, enabled/disabled)\n# Original permissions are preserved\n```\n\n## üìÅ Directory Structure\n\n### Local Backup Structure\n\n```\nchat-copilot/\n‚îú‚îÄ‚îÄ backups/\n‚îÇ   ‚îî‚îÄ‚îÄ systemd-YYYYMMDD_HHMMSS/\n‚îÇ       ‚îú‚îÄ‚îÄ ai-platform.service\n‚îÇ       ‚îú‚îÄ‚îÄ ai-platform.service.state\n‚îÇ       ‚îú‚îÄ‚îÄ ollama.service\n‚îÇ       ‚îú‚îÄ‚îÄ ollama.service.state\n‚îÇ       ‚îî‚îÄ‚îÄ ...\n‚îî‚îÄ‚îÄ logs/\n    ‚îî‚îÄ‚îÄ sync/\n        ‚îî‚îÄ‚îÄ systemd-sync-*.log\n```\n\n### Remote Sync Structure\n\n```\n/tmp/chat-copilot-systemd-sync/\n‚îú‚îÄ‚îÄ services/\n‚îÇ   ‚îú‚îÄ‚îÄ ai-platform.service\n‚îÇ   ‚îú‚îÄ‚îÄ ollama.service\n‚îÇ   ‚îî‚îÄ‚îÄ ...\n‚îî‚îÄ‚îÄ backup/\n    ‚îú‚îÄ‚îÄ ai-platform.service\n    ‚îú‚îÄ‚îÄ ai-platform.service.state\n    ‚îî‚îÄ‚îÄ ...\n```\n\n## üîÑ Workflow Examples\n\n### Development Workflow\n\n```bash\n# 1. Develop and test services locally\nsudo systemctl edit ai-platform.service\nsudo systemctl daemon-reload\nsudo systemctl restart ai-platform.service\n\n# 2. Backup current state\n./scripts/sync/rsync-systemd-services.sh backup\n\n# 3. Push to development server\n./scripts/sync/rsync-systemd-services.sh push dev-server --dry-run\n./scripts/sync/rsync-systemd-services.sh push dev-server\n\n# 4. Test on development server\nssh user@dev-server.com\nsudo systemctl status ai-platform.service\n```\n\n### Production Deployment\n\n```bash\n# 1. Create backup on production\n./scripts/sync/rsync-systemd-services.sh push prod-server --dry-run\n\n# 2. Full deployment with services\n./scripts/sync/rsync-platform-enhanced.sh full-deploy prod-server\n\n# 3. Verify services on production\nssh user@prod-server.com\nsudo systemctl status ai-platform.service\nsudo systemctl status ollama.service\n```\n\n### Multi-Environment Sync\n\n```bash\n# 1. Pull from development\n./scripts/sync/rsync-systemd-services.sh pull dev-server\n\n# 2. Test locally\nsudo systemctl daemon-reload\nsudo systemctl status ai-platform.service\n\n# 3. Push to staging\n./scripts/sync/rsync-systemd-services.sh push staging-server\n\n# 4. Deploy to production\n./scripts/sync/rsync-systemd-services.sh push prod-server\n```\n\n## ‚öôÔ∏è Configuration Options\n\n### Service Patterns\n\nCustomize which services are detected by editing the configuration:\n\n```bash\n# Edit rsync configuration\nnano scripts/sync/rsync-config.conf\n\n# Add custom patterns\nSYSTEMD_PATTERNS=(\n    \"*ai-platform*\"\n    \"*chat-copilot*\"\n    \"*custom-service*\"\n    \"*my-app*\"\n)\n```\n\n### Sync Options\n\n```bash\n# Available options\n--dry-run         # Preview changes without executing\n--force           # Skip confirmation prompts\n--include-all     # Include all systemd services (not just platform)\n--backup-dir DIR  # Custom backup directory\n--verbose         # Detailed output\n```\n\n## üö® Troubleshooting\n\n### Common Issues\n\n#### Permission Denied\n\n```bash\n# Issue: Cannot write to /etc/systemd/system/\n# Solution: Ensure sudo access\nsudo -v\n\n# Or configure passwordless sudo for systemctl\nsudo visudo\n```\n\n#### Service Not Found\n\n```bash\n# Issue: Service files not detected\n# Solution: Check service naming patterns\nls -la /etc/systemd/system/*ai-platform*\n\n# Add custom patterns to configuration\nnano scripts/sync/rsync-config.conf\n```\n\n#### Remote Sudo Issues\n\n```bash\n# Issue: Remote sudo requires password\n# Solution: Configure passwordless sudo or use ssh-agent\nssh-add ~/.ssh/id_rsa\n\n# Test remote sudo\nssh user@remote-server sudo systemctl --version\n```\n\n#### Service State Mismatch\n\n```bash\n# Issue: Services in different states after sync\n# Solution: Check service dependencies and configuration\nsudo systemctl status ai-platform.service\nsudo journalctl -u ai-platform.service\n\n# Reload and restart if needed\nsudo systemctl daemon-reload\nsudo systemctl restart ai-platform.service\n```\n\n### Debugging\n\n```bash\n# Enable verbose output\n./scripts/sync/rsync-systemd-services.sh scan --verbose\n\n# Check logs\ntail -f logs/sync/systemd-sync-*.log\n\n# Manual service detection\nfind /etc/systemd/system -name \"*ai-platform*\" -o -name \"*chat-copilot*\"\n\n# Test remote connection\nssh user@remote-server \"sudo systemctl list-units --type=service | grep ai-platform\"\n```\n\n## üìä Service Status Monitoring\n\n### Local Status Check\n\n```bash\n# Show all platform services status\n./scripts/sync/rsync-systemd-services.sh status\n\n# Output format:\nSERVICE                                  ACTIVE     ENABLED\n-------                                  ------     -------\nai-platform.service                      active     enabled\nollama.service                          active     enabled\nopenwebui-restore.service               inactive   disabled\n```\n\n### Remote Status Check\n\n```bash\n# Check remote service status\nssh user@remote-server \"sudo systemctl status ai-platform.service\"\n\n# List all platform services on remote\nssh user@remote-server \"sudo systemctl list-units --type=service | grep -E '(ai-platform|chat-copilot|ollama|openwebui)'\"\n```\n\n## üîÑ Service State Management\n\n### Backup Service States\n\nService states are automatically backed up with each operation:\n\n```bash\n# State file example: ai-platform.service.state\nACTIVE=active\nENABLED=enabled\n```\n\n### Restore Service States\n\n```bash\n# Services can be restored to their previous states\n./scripts/sync/rsync-systemd-services.sh install /path/to/backup\n\n# Enable services based on backup state\n./scripts/sync/rsync-systemd-services.sh enable\n```\n\n## üéØ Best Practices\n\n### 1. Always Backup First\n\n```bash\n# Create backup before any changes\n./scripts/sync/rsync-systemd-services.sh backup\n```\n\n### 2. Use Dry Run\n\n```bash\n# Preview changes before executing\n./scripts/sync/rsync-systemd-services.sh push prod-server --dry-run\n```\n\n### 3. Test in Development\n\n```bash\n# Test service changes in development first\n./scripts/sync/rsync-systemd-services.sh push dev-server\nssh user@dev-server.com \"sudo systemctl status ai-platform.service\"\n```\n\n### 4. Monitor Service Health\n\n```bash\n# Check service status after deployment\n./scripts/sync/rsync-systemd-services.sh status\nsudo journalctl -u ai-platform.service --since \"5 minutes ago\"\n```\n\n### 5. Version Control Service Files\n\n```bash\n# Keep service files in version control\ngit add systemd-services/\ngit commit -m \"Update AI platform service configuration\"\n```\n\n## üìö Integration with Platform Sync\n\nThe systemd services sync is fully integrated with the main platform sync:\n\n### Automatic Integration\n\n```bash\n# Include systemd services in platform sync\n./scripts/sync/rsync-platform-enhanced.sh push dev-server --include-systemd\n\n# Full deployment automatically includes systemd\n./scripts/sync/rsync-platform-enhanced.sh full-deploy prod-server\n```\n\n### Manual Integration\n\n```bash\n# Sync platform first, then services\n./scripts/sync/rsync-platform.sh push dev-server\n./scripts/sync/rsync-systemd-services.sh push dev-server\n\n# Or use the enhanced script\n./scripts/sync/rsync-platform-enhanced.sh systemd push dev-server\n```\n\n## üîç Advanced Usage\n\n### Custom Service Patterns\n\n```bash\n# Include additional service patterns\nexport SYSTEMD_PATTERNS=(\"*ai-platform*\" \"*my-custom-service*\")\n./scripts/sync/rsync-systemd-services.sh scan\n```\n\n### Selective Service Sync\n\n```bash\n# Sync only specific services (modify script as needed)\n# This would require script customization for specific use cases\n```\n\n### Cross-Platform Deployment\n\n```bash\n# Deploy from development to multiple environments\n./scripts/sync/rsync-systemd-services.sh push dev-server\n./scripts/sync/rsync-systemd-services.sh push staging-server\n./scripts/sync/rsync-systemd-services.sh push prod-server\n```\n\n---\n\n## üéâ Summary\n\nThe systemd services synchronization system provides:\n\n‚úÖ **Automatic Detection** - Finds platform-related services automatically  \n‚úÖ **Safe Operations** - Always creates backups before changes  \n‚úÖ **State Preservation** - Maintains service enabled/disabled states  \n‚úÖ **Remote Deployment** - Sync services across multiple servers  \n‚úÖ **Integration** - Works seamlessly with platform sync  \n‚úÖ **Security** - Handles sudo requirements safely  \n‚úÖ **Monitoring** - Provides status and health checking  \n\n**Key Commands to Remember:**\n- `./scripts/sync/rsync-systemd-services.sh scan` - Check local services\n- `./scripts/sync/rsync-systemd-services.sh push <target>` - Deploy services\n- `./scripts/sync/rsync-platform-enhanced.sh full-deploy <target>` - Complete deployment\n- `./scripts/sync/rsync-systemd-services.sh status` - Monitor service health\n\n**Your systemd services are now fully synchronized and deployment-ready! üöÄ**"